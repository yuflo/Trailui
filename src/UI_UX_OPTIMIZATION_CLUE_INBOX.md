# 线索收件箱 UI/UX 优化

## 📋 优化内容

### 1. 收件箱图标红色计数优化

**优化前：** 显示所有线索的总数
```tsx
{extractedClues.length > 0 && (
  <div className="badge">
    {extractedClues.length}  // ❌ 包括未追踪、追踪中和已完成的所有线索
  </div>
)}
```

**优化后：** 只显示在追踪中的线索数
```tsx
{(() => {
  // 只计数在追踪中的线索（正在进行的故事）
  const trackingCount = extractedClues.filter(clue => clue.status === 'tracking').length;
  return trackingCount > 0 && (
    <div className="badge">
      {trackingCount}  // ✅ 只显示正在进行的故事数量
    </div>
  );
})()}
```

**优化理由：**
- 红色数字徽章提醒玩家"有多少个正在进行的故事"
- 未追踪的线索：玩家知道在收件箱中，不需要红点提醒
- 已完成的故事：不需要持续提醒
- 追踪中的故事：需要玩家继续推进，应该用红点突出显示

---

### 2. 已完成故事的"进入故事"按钮禁用

**优化前：** 已完成的故事仍可点击"进入故事"
```tsx
<Button
  onClick={() => handleEnterStory(currentClue.clue_id)}
  className="..."
>
  <Play className="w-4 h-4 mr-2" />
  {trackedStory.entry_point_action?.label || '开启故事'}
</Button>
```

**优化后：** 已完成的故事按钮禁用且显示明确状态
```tsx
<Button
  onClick={() => handleEnterStory(currentClue.clue_id)}
  disabled={trackedStory.status === 'completed'}  // ✅ 禁用已完成的故事
  className="... disabled:opacity-50 disabled:cursor-not-allowed"
>
  <Play className="w-4 h-4 mr-2" />
  {trackedStory.status === 'completed' 
    ? '故事已完成'  // ✅ 明确的状态提示
    : (trackedStory.entry_point_action?.label || '开启故事')
  }
</Button>
```

**优化理由：**
- 防止玩家误操作尝试重新进入已完成的故事
- 视觉上明确区分可进入和已完成的故事
- 按钮文字动态变化，提供清晰的状态反馈

---

## 🎨 视觉效果对比

### 收件箱图标

**优化前：**
```
📥 [3]  ← 包括 1 个未追踪 + 1 个追踪中 + 1 个已完成
```

**优化后：**
```
📥 [1]  ← 只显示 1 个追踪中（正在进行的故事）
📥      ← 没有追踪中的故事时不显示徽章
```

### 进入故事按钮

**优化前：**
```
[追踪中的故事]
┌─────────────────┐
│ ▶ 进入故事      │  ← 可点击
└─────────────────┘

[已完成的故事]
┌─────────────────┐
│ ▶ 进入故事      │  ← 仍然可点击 ❌
└─────────────────┘
```

**优化后：**
```
[追踪中的故事]
┌─────────────────┐
│ ▶ 进入故事      │  ← 可点击 ✅
└─────────────────┘

[已完成的故事]
┌─────────────────┐
│ ▶ 故事已完成    │  ← 禁用，半透明 ✅
└─────────────────┘
```

---

## 📊 用户体验改进

### 改进点 1：明确进行中的任务
- **优化前：** 玩家看到红色 [3]，包括所有线索，不知道哪些正在进行
- **优化后：** 红色数字只代表正在追踪的故事，清晰提示"你有N个故事正在进行"

### 改进点 2：防止误操作
- **优化前：** 玩家可能误点已完成故事，造成困惑
- **优化后：** 按钮禁用，明确告知"已完成"状态

### 改进点 3：视觉层级清晰
- **优化前：** 所有线索同等权重，难以区分
- **优化后：** 通过计数和按钮状态，明确优先级

---

## 🔧 实现细节

### 文件位置
- **文件：** `/App.tsx`
- **修改行数：**
  1. 第 1692-1701 行：收件箱图标计数
  2. 第 2015-2025 行：进入故事按钮

### 线索状态说明

```typescript
type ClueStatus = 
  | 'untracked'   // 未追踪 - 不显示在红色计数中 ❌ (玩家已知，无需提醒)
  | 'tracking'    // 追踪中 - 应该显示在红色计数中 ✅ (正在进行，需要提醒)
  | 'completed';  // 已完成 - 不显示在红色计数中 ❌ (已结束，无需提醒)
```

### 故事状态说明

```typescript
type StoryStatus = 
  | 'tracking'    // 追踪中 - 可以进入 ✅
  | 'completed';  // 已完成 - 不可进入 ❌
```

---

## ✅ 测试验证

### 测试场景 1：收件箱计数

**步骤：**
1. 从 Ticker 提取 3 条线索
2. 追踪其中 1 条线索
3. 进入故事并完成
4. 再追踪第 2 条线索

**预期结果：**
- 初始（3条未追踪）：红色徽章不显示 ⭕
- 追踪第1条后：红色徽章显示 [1] ✅
- 完成第1条后：红色徽章不显示 ⭕
- 追踪第2条后：红色徽章显示 [1] ✅
- 同时追踪多条：红色徽章显示正确的追踪中数量

### 测试场景 2：进入故事按钮

**步骤：**
1. 追踪一条线索
2. 打开收件箱，点击该线索
3. 观察"进入故事"按钮
4. 进入故事并完成
5. 再次打开收件箱，查看该线索

**预期结果：**
- 追踪中：按钮正常，显示"进入故事"
- 已完成：按钮禁用，显示"故事已完成"
- 按钮样式：半透明，鼠标悬停显示 not-allowed

---

## 🎯 设计原则

### 1. **突出进行中的任务**
- 红色徽章作为"任务提醒"，显示正在进行的故事数
- 未开始的线索在收件箱中，不需要红点干扰
- 已完成的故事不需要持续提醒

### 2. **明确状态反馈**
- 禁用状态应该明确可见
- 按钮文字应该准确描述当前状态

### 3. **防止误操作**
- 不可用功能应该禁用，而非隐藏
- 让用户理解为什么不能操作

---

## 📝 后续优化建议

### 可选优化 1：已完成线索的视觉区分
```tsx
// 在收件箱列表中，给已完成的线索添加特殊样式
<div className={`
  ${clue.status === 'completed' ? 'opacity-60' : ''}
`}>
  {clue.title}
</div>
```

### 可选优化 2：徽章颜色分级
```tsx
// 根据未追踪线索数量改变徽章颜色
const getBadgeColor = (count: number) => {
  if (count === 0) return '';
  if (count <= 2) return 'bg-yellow-500'; // 较少
  if (count <= 5) return 'bg-orange-500'; // 中等
  return 'bg-red-500'; // 很多
};
```

### 可选优化 3：已完成故事的回顾功能
```tsx
// 为已完成的故事添加"回顾"按钮
{trackedStory.status === 'completed' && (
  <Button variant="outline">
    <Eye className="w-4 h-4 mr-2" />
    回顾故事
  </Button>
)}
```

---

**优化时间：** 2025-11-10  
**优化类型：** UI/UX 交互优化  
**影响范围：** 线索收件箱界面  
**状态：** ✅ 已完成
