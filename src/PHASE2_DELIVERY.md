# Phase 2: æœåŠ¡å±‚ä¸å¼•æ“æ ¸å¿ƒ - äº¤ä»˜æŠ¥å‘Š

## âœ… å®ŒæˆçŠ¶æ€

**çŠ¶æ€**: å·²å®Œæˆ  
**æ—¥æœŸ**: 2025-10-29  
**é¢„è®¡æ—¶é—´**: 8-10å°æ—¶  
**å®é™…å®Œæˆ**: 1æ¬¡äº¤ä»˜

---

## ğŸ“¦ äº¤ä»˜ç‰©æ¸…å•

### 1. æœåŠ¡å±‚å®ç° âœ…

åˆ›å»ºäº†å®Œæ•´çš„æœåŠ¡å±‚å®ç°ï¼Œæ¡¥æ¥æ•°æ®å’Œå¼•æ“ï¼š

```
engine/services/
â”œâ”€â”€ impl/
â”‚   â”œâ”€â”€ StoryServiceImpl.ts       (æ•…äº‹æœåŠ¡å®ç°)
â”‚   â”œâ”€â”€ VisualServiceImpl.ts      (è§†è§‰æœåŠ¡å®ç°)
â”‚   â”œâ”€â”€ TickerServiceImpl.ts      (TickeræœåŠ¡å®ç°)
â”‚   â””â”€â”€ index.ts                  (ç»Ÿä¸€å¯¼å‡º)
â”‚
â”œâ”€â”€ ServiceContainer.ts           (ä¾èµ–æ³¨å…¥å®¹å™¨)
â””â”€â”€ index.ts                      (ç»Ÿä¸€å¯¼å‡º)
```

**å…³é”®ç‰¹æ€§**:
- âœ… `StoryServiceImpl` - ä» `stories/` åŠ è½½æ•…äº‹æ•°æ®
- âœ… `VisualServiceImpl` - åº”ç”¨CSSå˜é‡åˆ° `document.documentElement`
- âœ… `TickerServiceImpl` - æä¾›éšæœºæ¶ˆæ¯æ•°æ®
- âœ… `ServiceContainer` - å•ä¾‹æ¨¡å¼ï¼Œç®¡ç†æ‰€æœ‰æœåŠ¡å®ä¾‹
- âœ… å®Œæ•´å®ç° Phase 1 å®šä¹‰çš„æ¥å£å¥‘çº¦

### 2. å­ç³»ç»Ÿæ„å»º âœ…

åˆ›å»ºäº†4ä¸ªæ ¸å¿ƒå­ç³»ç»Ÿï¼Œä» App.tsx æå–ä¸šåŠ¡é€»è¾‘ï¼š

```
engine/systems/
â”œâ”€â”€ StatSystem.ts                 (æ•°å€¼ç³»ç»Ÿ)
â”œâ”€â”€ RapportSystem.ts              (å…³ç³»ç³»ç»Ÿ)
â”œâ”€â”€ BehaviorSystem.ts             (è¡Œä¸ºç³»ç»Ÿ)
â”œâ”€â”€ TickerSystem.ts               (ä¿¡æ¯æµç³»ç»Ÿ)
â””â”€â”€ index.ts                      (ç»Ÿä¸€å¯¼å‡º)
```

**StatSystemï¼ˆæ•°å€¼ç³»ç»Ÿï¼‰**:
```typescript
detectChanges(oldStats, newStats): StatDelta[]
  - æ£€æµ‹ä½“åŠ›/å¿ƒåŠ›å˜åŒ–
  - è®¡ç®—deltaå€¼
  
calculateChangePercentage(old, new, max): number
  - è®¡ç®—å˜åŒ–ç™¾åˆ†æ¯”
  
isDangerZone(value, max): boolean
  - åˆ¤æ–­æ˜¯å¦å¤„äºå±é™©åŒºåŸŸ
```

**RapportSystemï¼ˆå…³ç³»ç³»ç»Ÿï¼‰**:
```typescript
detectChange(oldNpc, newNpc): RapportDelta | null
  - æ£€æµ‹NPCå…³ç³»å€¼å˜åŒ–
  - æ£€æµ‹æƒ…æ„Ÿç±»å‹å˜åŒ–
  
getSentimentColor(sentiment): string
  - è·å–å…³ç³»æƒ…æ„Ÿçš„é¢œè‰²ç±»å
  
getIntensityDescription(intensity): string
  - è·å–å…³ç³»å¼ºåº¦çš„æè¿°
```

**BehaviorSystemï¼ˆè¡Œä¸ºç³»ç»Ÿï¼‰**:
```typescript
addPlayerBehavior(narrative): ExtendedBehaviorItem
  - æ·»åŠ ç©å®¶è¡Œä¸ºåˆ°å†å²
  
addNpcBehaviors(behaviors): void
  - æ‰¹é‡æ·»åŠ NPCè¡Œä¸º
  
addSystemNarrative(narrative): ExtendedBehaviorItem
  - æ·»åŠ ç³»ç»Ÿå™äº‹
  
getHistory(): ExtendedBehaviorItem[]
  - è·å–å®Œæ•´è¡Œä¸ºå†å²
```

**TickerSystemï¼ˆä¿¡æ¯æµç³»ç»Ÿï¼‰**:
```typescript
start(): void
  - å¯åŠ¨å®šæ—¶æ›´æ–°ï¼ˆé»˜è®¤8ç§’ï¼‰
  
stop(): void
  - åœæ­¢æ›´æ–°
  
subscribe(listener): unsubscribe
  - è®¢é˜…æ¶ˆæ¯æ›´æ–°
  
addMessage(message): void
  - æ‰‹åŠ¨æ·»åŠ æ¶ˆæ¯
```

### 3. å¼•æ“æ ¸å¿ƒæ„å»º âœ…

åˆ›å»ºäº†3ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œåè°ƒæ‰€æœ‰ç³»ç»Ÿï¼š

```
engine/core/
â”œâ”€â”€ StateManager.ts               (çŠ¶æ€ç®¡ç†å™¨)
â”œâ”€â”€ TurnManager.ts                (å›åˆç®¡ç†å™¨)
â”œâ”€â”€ GameEngine.ts                 (æ¸¸æˆå¼•æ“)
â””â”€â”€ index.ts                      (ç»Ÿä¸€å¯¼å‡º)
```

**StateManagerï¼ˆçŠ¶æ€ç®¡ç†å™¨ï¼‰**:
```typescript
initStory(storyId, config, scenarios): void
  - åˆå§‹åŒ–æ•…äº‹çŠ¶æ€
  
advanceTurn(): boolean
  - æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªå›åˆ
  
getCurrentScenario(): ScenarioSnapshot
  - è·å–å½“å‰åœºæ™¯
  
getState(): GameState
  - è·å–å®Œæ•´çŠ¶æ€ï¼ˆåªè¯»ï¼‰
```

**TurnManagerï¼ˆå›åˆç®¡ç†å™¨ï¼‰**:
```typescript
async submitAction(intentText): Promise<TurnResult>
  - æäº¤ç©å®¶æ„å›¾
  - æ¨è¿›å›åˆ
  - è®¡ç®—æ•°å€¼å’Œå…³ç³»å˜åŒ–
  - æ›´æ–°è¡Œä¸ºå†å²
  - è¿”å›å®Œæ•´çš„å›åˆç»“æœ
  
goToTurn(turnIndex): TurnResult
  - è·³è½¬åˆ°æŒ‡å®šå›åˆ
```

**GameEngineï¼ˆæ¸¸æˆå¼•æ“ï¼‰**:
```typescript
async initialize(): Promise<void>
  - åˆå§‹åŒ–å¼•æ“ï¼Œå¯åŠ¨Tickerç³»ç»Ÿ
  
async getAllStories(): Promise<StoryConfig[]>
  - è·å–æ‰€æœ‰å¯ç”¨æ•…äº‹
  
async startGame(storyId): Promise<GameState>
  - å¼€å§‹æ¸¸æˆï¼Œè‡ªåŠ¨åº”ç”¨è§†è§‰åŸå‹
  
async submitAction(intentText): Promise<TurnResult>
  - æäº¤ç©å®¶åŠ¨ä½œ
  
getCurrentState(): GameState
  - è·å–å½“å‰æ¸¸æˆçŠ¶æ€
  
async switchStory(storyId): Promise<GameState>
  - åˆ‡æ¢æ•…äº‹
  
on/off(eventType, listener): void
  - äº‹ä»¶ç›‘å¬ç³»ç»Ÿ
  
destroy(): void
  - é”€æ¯å¼•æ“ï¼Œæ¸…ç†èµ„æº
```

### 4. æµ‹è¯•è„šæœ¬ âœ…

åˆ›å»ºäº†å¼•æ“æµ‹è¯•è„šæœ¬ï¼š

```
engine/
â””â”€â”€ test-engine.ts                (æµ‹è¯•è„šæœ¬)
```

---

## ğŸ“Š æ–‡ä»¶ç»Ÿè®¡

| ç±»åˆ« | æ–°å¢æ–‡ä»¶ | æ€»è®¡ |
|------|---------|------|
| æœåŠ¡å±‚ | 6 | 6 |
| å­ç³»ç»Ÿ | 5 | 5 |
| å¼•æ“æ ¸å¿ƒ | 4 | 4 |
| æµ‹è¯• | 1 | 1 |
| **æ€»è®¡** | **16** | **16** |

---

## ğŸ” æ¶æ„è®¾è®¡

### å®Œæ•´çš„å¼•æ“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  UI Layer (App.tsx)                  â”‚
â”‚              ä¸‹ä¸€é˜¶æ®µå°†æ”¹ä¸ºä½¿ç”¨å¼•æ“API                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GameEngine API                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ getAllStories()                            â”‚  â”‚
â”‚  â”‚  â€¢ startGame(storyId)                         â”‚  â”‚
â”‚  â”‚  â€¢ submitAction(intent)                       â”‚  â”‚
â”‚  â”‚  â€¢ getCurrentState()                          â”‚  â”‚
â”‚  â”‚  â€¢ switchStory(storyId)                       â”‚  â”‚
â”‚  â”‚  â€¢ on/off(event, listener)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Core Components                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ StateManager â”‚  â”‚ TurnManager  â”‚  â”‚   äº‹ä»¶    â”‚ â”‚
â”‚  â”‚  ç»´æŠ¤çŠ¶æ€    â”‚  â”‚  å›åˆæ¨è¿›    â”‚  â”‚   ç³»ç»Ÿ    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Sub Systems                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Stat    â”‚ â”‚  Rapport   â”‚ â”‚  Behavior  â”‚       â”‚
â”‚  â”‚  System   â”‚ â”‚  System    â”‚ â”‚  System    â”‚       â”‚
â”‚  â”‚  æ•°å€¼è®¡ç®—  â”‚ â”‚  å…³ç³»è®¡ç®—  â”‚ â”‚  è¡Œä¸ºç®¡ç†  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚         Ticker System                  â”‚        â”‚
â”‚  â”‚         ä¿¡æ¯æµç®¡ç†                      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Service Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    Story     â”‚  â”‚    Visual    â”‚  â”‚  Ticker   â”‚ â”‚
â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚  Service  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â†‘ ServiceContainer â†‘                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Data Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   stories/   â”‚  â”‚    config/   â”‚  â”‚   data/   â”‚ â”‚
â”‚  â”‚   æ•…äº‹æ•°æ®    â”‚  â”‚   è§†è§‰é…ç½®   â”‚  â”‚  ä¸–ç•Œæ•°æ®  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

```
ç”¨æˆ·æ„å›¾ (Intent Text)
    â†“
GameEngine.submitAction()
    â†“
TurnManager.submitAction()
    â†“
1. BehaviorSystem.addPlayerBehavior()      æ·»åŠ ç©å®¶è¡Œä¸º
2. StateManager.advanceTurn()              æ¨è¿›å›åˆ
3. StatSystem.detectChanges()              è®¡ç®—æ•°å€¼å˜åŒ–
4. RapportSystem.detectChange()            è®¡ç®—å…³ç³»å˜åŒ–
5. BehaviorSystem.addNpcBehaviors()        æ·»åŠ NPCè¡Œä¸º
6. BehaviorSystem.addSystemNarrative()     æ·»åŠ ç³»ç»Ÿå™äº‹
    â†“
è¿”å› TurnResult
    â†“
è§¦å‘ 'turnComplete' äº‹ä»¶
    â†“
UIæ›´æ–°ï¼ˆPhase 3å®ç°ï¼‰
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. å®Œå…¨è§£è€¦çš„æ¶æ„

- âœ… å¼•æ“ä¸ç›´æ¥è®¿é—®æ•°æ®ï¼Œé€šè¿‡æœåŠ¡å±‚
- âœ… UIï¼ˆä¸‹ä¸€é˜¶æ®µï¼‰ä¸ç›´æ¥è®¿é—®æ•°æ®ï¼Œé€šè¿‡å¼•æ“API
- âœ… å„ä¸ªç³»ç»ŸèŒè´£å•ä¸€ï¼Œå¯ç‹¬ç«‹æµ‹è¯•

### 2. äº‹ä»¶é©±åŠ¨

```typescript
// ç›‘å¬å›åˆå®Œæˆäº‹ä»¶
engine.on('turnComplete', (event) => {
  const { result } = event.data;
  console.log('Turn completed', result);
});

// ç›‘å¬é”™è¯¯äº‹ä»¶
engine.on('error', (event) => {
  console.error('Engine error', event.data);
});
```

### 3. å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘æå–

ä» App.tsx æå–çš„æ‰€æœ‰æ ¸å¿ƒé€»è¾‘ï¼š

| åŸä½ç½® | æ–°ä½ç½® | è¯´æ˜ |
|--------|--------|------|
| ç¬¬230-250è¡Œ | StatSystem | æ•°å€¼å˜åŒ–è®¡ç®— |
| ç¬¬252-283è¡Œ | RapportSystem | å…³ç³»å€¼å˜åŒ–è®¡ç®— |
| ç¬¬210-306è¡Œ | TurnManager | å›åˆæ¨è¿›é€»è¾‘ |
| ç¬¬112-115è¡Œ | TickerSystem | æ¶ˆæ¯å®šæ—¶æ›´æ–° |
| ç¬¬148-167è¡Œ | VisualServiceImpl | è§†è§‰åŸå‹åº”ç”¨ |

### 4. ä¾èµ–æ³¨å…¥

ä½¿ç”¨ ServiceContainer å•ä¾‹æ¨¡å¼ï¼š

```typescript
const container = ServiceContainer.getInstance();
const storyService = container.getStoryService();
const visualService = container.getVisualService();
const tickerService = container.getTickerService();
```

---

## âœ… éªŒè¯æ­¥éª¤

### æµ‹è¯•å¼•æ“åŠŸèƒ½

å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æµ‹è¯•å¼•æ“ï¼š

```typescript
import { testEngine } from './engine/test-engine';

// è¿è¡Œæµ‹è¯•
const result = await testEngine();

// æˆ–åœ¨æµè§ˆå™¨æ§åˆ¶å°
window.testEngine();
```

æµ‹è¯•åŒ…å«ï¼š
1. âœ… åˆ›å»ºå¼•æ“å®ä¾‹
2. âœ… åˆå§‹åŒ–å¼•æ“
3. âœ… è·å–æ‰€æœ‰æ•…äº‹
4. âœ… å¼€å§‹æ¸¸æˆ (tense-alley)
5. âœ… æäº¤ç©å®¶æ„å›¾
6. âœ… æ£€æŸ¥æ•°å€¼å’Œå…³ç³»å˜åŒ–
7. âœ… è·å–è¡Œä¸ºå†å²
8. âœ… æµ‹è¯•Tickerç³»ç»Ÿ
9. âœ… é”€æ¯å¼•æ“

### æ‰‹åŠ¨æµ‹è¯•ç¤ºä¾‹

```typescript
import { GameEngine } from './engine';

// 1. åˆ›å»ºå¼•æ“
const engine = new GameEngine({ debug: true });

// 2. åˆå§‹åŒ–
await engine.initialize();

// 3. è·å–æ•…äº‹åˆ—è¡¨
const stories = await engine.getAllStories();
console.log(stories); // [{ id: 'tense-alley', ... }]

// 4. å¼€å§‹æ¸¸æˆ
const state = await engine.startGame('tense-alley');
console.log(state.currentScenario);

// 5. æäº¤æ„å›¾
const result = await engine.submitAction('æˆ‘å®‰æ…°å¥¹');
console.log(result.statDeltas);     // æ•°å€¼å˜åŒ–
console.log(result.rapportDeltas);  // å…³ç³»å˜åŒ–

// 6. ç›‘å¬äº‹ä»¶
engine.on('turnComplete', (e) => {
  console.log('å›åˆå®Œæˆ', e.data);
});

// 7. é”€æ¯
engine.destroy();
```

---

## ğŸš€ ä¸‹ä¸€é˜¶æ®µé¢„è§ˆ

### Phase 3: APIå°è£…ä¸UIè§£è€¦

å°†è¦å®ç°ï¼š

1. **å¼•æ“APIç»Ÿä¸€æ¥å£**
   - `GameEngineAPI` ç±»ï¼ˆæ›´é«˜å±‚æ¬¡çš„å°è£…ï¼‰
   - ç»Ÿä¸€çš„äº‹ä»¶ç³»ç»Ÿ
   - Promise-based å¼‚æ­¥API

2. **UIå±‚å®Œå…¨é‡æ„**
   - `App.tsx` æ”¹ä¸ºä½¿ç”¨ GameEngine
   - ç§»é™¤æ‰€æœ‰ç›´æ¥æ•°æ®è®¿é—®
   - ç§»é™¤æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ä»£ç 
   - é€šè¿‡äº‹ä»¶ç›‘å¬æ›´æ–°UI

3. **ç»„ä»¶æ‹†åˆ†ï¼ˆå¯é€‰ï¼‰**
   - BroadcastPanel
   - DynamicViewPanel
   - StatusPanel

---

## ğŸ“ é‡è¦è¯´æ˜

### ä¿æŒç‹¬ç«‹è¿è¡Œ

- âœ… å¼•æ“å¯ä»¥ç‹¬ç«‹äºUIè¿è¡Œ
- âœ… é€šè¿‡ `testEngine()` éªŒè¯åŠŸèƒ½
- âœ… æ‰€æœ‰ç³»ç»Ÿé€šè¿‡æ¥å£è§£è€¦

### æœªä¿®æ”¹çš„æ–‡ä»¶

æŒ‰ç…§è®¡åˆ’ï¼Œä»¥ä¸‹æ–‡ä»¶åœ¨ Phase 2 ä¸åšä¿®æ”¹ï¼š

- âŒ `App.tsx` - å°†åœ¨ Phase 3 é‡æ„
- âŒ `data/mock/themes/` - å°†åœ¨ Phase 4 åˆ é™¤
- âŒ ä»»ä½•UIç»„ä»¶

---

## âœ… éªŒæ”¶ç¡®è®¤

Phase 2 å·²å®Œæˆæ‰€æœ‰äº¤ä»˜ç‰©ï¼Œæ»¡è¶³ä»¥ä¸‹éªŒæ”¶æ ‡å‡†ï¼š

- [x] æ‰€æœ‰æœåŠ¡æ¥å£å’Œå®ç°ç¼–è¯‘é€šè¿‡
- [x] å¯ä»¥é€šè¿‡æœåŠ¡å±‚æˆåŠŸåŠ è½½ `tense-alley` æ•…äº‹
- [x] VisualService å¯ä»¥æ­£ç¡®åº”ç”¨CSSå˜é‡åˆ°DOM
- [x] GameEngine å¯ä»¥ç‹¬ç«‹åˆå§‹åŒ–å’Œè¿è¡Œï¼ˆä¸ä¾èµ–UIï¼‰
- [x] æ‰€æœ‰ç³»ç»Ÿé€šè¿‡æœåŠ¡å±‚è®¿é—®æ•°æ®ï¼ˆæ— ç›´æ¥importæ•°æ®æ–‡ä»¶ï¼‰
- [x] æµ‹è¯•è„šæœ¬éªŒè¯å¼•æ“åŠŸèƒ½æ­£å¸¸

---

## ğŸ‰ æ€»ç»“

Phase 2 æˆåŠŸæ„å»ºäº†å®Œæ•´çš„å¼•æ“ç³»ç»Ÿï¼š

1. âœ… **æœåŠ¡å±‚** - æ¡¥æ¥æ•°æ®å’Œå¼•æ“ï¼Œç»Ÿä¸€è®¿é—®æ¥å£
2. âœ… **å­ç³»ç»Ÿ** - ä»App.tsxæå–æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
3. âœ… **å¼•æ“æ ¸å¿ƒ** - åè°ƒæ‰€æœ‰ç³»ç»Ÿï¼Œæä¾›ç»Ÿä¸€API
4. âœ… **äº‹ä»¶ç³»ç»Ÿ** - æ”¯æŒå¼‚æ­¥é€šçŸ¥å’Œè§£è€¦

å¼•æ“å·²ç»å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œå¯ä»¥å®‰å…¨åœ°è¿›å…¥ **Phase 3: APIå°è£…ä¸UIè§£è€¦** çš„å¼€å‘ã€‚
